	
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fractals of the World â€“ Accessible Version</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="lang-en">

  <!-- ğŸ”— Skip link for screen readers -->
  <a href="#introduction" class="skip-link" style="position:absolute;top:-40px;left:0;background:#000;color:#fff;padding:8px;z-index:100;">Skip to main content</a>

  <!-- ğŸ¨ Exhibition Header -->
  <header class="entree-exposition" role="banner" aria-labelledby="fractales">
    <h1 id="fractales">ğŸ–¼ï¸ Fractals of the World: Reflections of Souls</h1>
    <div id="first" class="citation-stylisee">
      Welcome to an exhibition where each image is a door, each spiral a breath, and each pixel a memory.
    </div>
    <div class="retour-carte">
      <a href="#introduction" id="btn_enter" class="nav-btn retour" title="Start the poetic journey">âœ¨ Enter the Exhibition</a>
    </div>
  </header>

  <main role="main">
    <section id="introduction" class="introduction" role="region" aria-labelledby="prologue_sensible">
      <h2 id="prologue_sensible">ğŸ–¼ï¸ Sensitive Prologue â€“ Poetic Introduction</h2>
      <div id="intro_poetique" class="citation-stylisee">
        Close your eyesâ€¦ and open your soul. You are entering a world where boundaries dissolve.  
        Here, every image is a breath, every spiral a memory.  
        Fractals are not just patternsâ€¦ they are reflections of souls scattered to the four winds of the world.  
        Follow the light, listen to the hidden rhythm behind the pixels, and let yourself be carried awayâ€¦
      </div>
      <div class="retour-carte">
        <a href="#carte" id="btn_map_0" class="nav-btn retour" title="Access the interactive map">ğŸ—ºï¸ Interactive map</a>
      </div>
    </section>

    <!-- ğŸ—ºï¸ Interactive Map -->
    <section id="carte" class="interactive-map" role="region" aria-labelledby="carte_interactive">
      <h2 id="carte_interactive">ğŸ—ºï¸ Interactive map</h2>
      <div class="carte-container">
        <div class="carte-wrapper">
          <img id="fractals-img" src="carte-interactive-en.jpg" title="Interactive fractal map with clickable regions for each room" alt="Interactive fractal map with clickable regions for each room" usemap="#map-salles" />
          <p id="image-caption" class="caption">Each spiral tells a story. Let the patterns guide your soul.</p>

          <!-- Zones & Points with tabindex -->
          <a href="#hampi" class="debug-zone-en hampi" title="Room 1 â€“ Hampi" tabindex="0"></a>
          <a href="#bali" class="debug-zone-en bali" title="Room 2 â€“ Bali" tabindex="0"></a>
          <a href="#flores" class="debug-zone-en flores" title="Room 3 â€“ Flores" tabindex="0"></a>
          <a href="#perou" class="debug-zone-en perou" title="Room 4 â€“ Peru" tabindex="0"></a>

          <a href="#hampi" class="carte-point-en hampi" title="Hampi" tabindex="0"></a>
          <a href="#bali" class="carte-point-en bali" title="Bali" tabindex="0"></a>
          <a href="#flores" class="carte-point-en flores" title="Flores" tabindex="0"></a>
          <a href="#perou" class="carte-point-en perou" title="Peru" tabindex="0"></a>
        </div>
      </div>
    </section>

   <!-- Quick navigation -->
   <section id="quick-navigation" class="access-content" aria-labelledby="nav_subtitles">
	  <h2 id="nav_subtitles">ğŸ§ Quick Navigation â€“ Subtitles & Transcriptions</h2>
	  <ul>
		<li><a href="#subtitles_hampi">ğŸ§ Room 1: Hampi</a></li>
		<li><a href="#subtitles_bali">ğŸ§ Room 2: Bali</a></li>
		<li><a href="#subtitles_flores">ğŸ§ Room 3: Flores</a></li>
		<li><a href="#subtitles_peru">ğŸ§ Room 4: Peru</a></li>
	  </ul>
	</section>


    <!-- ğŸ•‰ï¸ Room 1 â€” Hampi Market -->
    <section id="hampi" role="region" aria-labelledby="salle_hampi">
      <h2 id="salle_hampi">ğŸ•‰ï¸ Room 1 â€” Hampi Market</h2>
      <div class="table-image-container">
        <img src="Hampi.jpg" id="char_hampi" alt="Mystical chariot in Hampi market surrounded by flowing fabrics" />
        <table>
          <thead>
            <tr>
              <th id="element1">Element</th>
              <th id="lien1">Link</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td id="hampi_desc">Mystical Chariot of Hampi</td>
              <td></td>
            </tr>
            <tr>
              <td id="mandala">Mandalas and flowing fabrics</td>
              <td></td>
            </tr>
            <tr>
              <td id="vithala">Soundscape: Musical pillars of the Vithala temple</td>
              <td>ğŸ¶ <a href="https://www.youtube.com/watch?v=UOFoQ70m6Z8" id="ecoute1" target="_blank" rel="noopener noreferrer">Listen</a></td>
            </tr>
          </tbody>
        </table>
      </div>
	  <section class="access-content" aria-labelledby="subtitles_hampi">
		  <h3 id="subtitles_hampi">ğŸ§ Subtitles & Transcription â€“ Room 1: Hampi</h3>
		  <ul>
			<li>[Gentle rustling of fabric â€” vibrant hues sway]</li>
			<li>[Distant chatter of market-goers â€” lively atmosphere]</li>
			<li>[Rhythmic tones of the musical pillars â€” sacred resonance]</li>
		  </ul>
		  <p class="transcription">
			The market hums with life. Fabrics sway, their colors vivid even in the mind's eye.  
			The chariot stands timeless, a symbol of Hampi's rich history.  
			The musical pillars sing, their notes weaving stories of devotion and artistry.
		  </p>
		  <div aria-label="Audiodescription for the visually impaired"> 
		  <h4>Narration</h4> 
		  <p>Imagine a bustling market in Hampi, where the mystical chariot stands as a centerpiece. 
		  The fabrics flow gently in the breeze, their vibrant colors creating a kaleidoscope of hues. 
		  The sound of the musical pillars resonates, each note painting an auditory picture of the temple's grandeur.</p> 
		  <h4>Soundscape Enrichment</h4> 
		  <audio controls>
			  <source src="hampi-sound.mp3" type="audio/mpeg">
			  Your browser does not support the audio element. 
		  </audio>
		  <p>The gentle rustle of fabric, the distant chatter of market-goers, and the rhythmic tones of the pillars create an immersive auditory journey.</p> 
		  </div>
		  <div class="retour-navigation">
		    <a href="#quick-navigation" class="nav-btn retour" title="Return to subtitle index">ğŸ” Back to Quick Navigation</a>
		  </div>
	 </section>
    </section>

    <!-- ğŸŒº Room 2 â€” Bali the Beautiful Island -->
    <section id="bali" role="region" aria-labelledby="salle_bali">
      <h2 id="salle_bali">ğŸŒº Room 2 â€” Bali the Beautiful Island</h2>
      <div class="table-image-container">
        <img src="Bali.jpg" id="paysage_bali" alt="Spiritual Balinese landscape with rice terraces and mandalas" />
        <table>
          <thead>
            <tr>
              <th id="element2">Element</th>
              <th id="lien2">Link</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td id="ceremonie">ğŸŒ¾ Sacred rice fields and offerings</td>
              <td></td>
            </tr>
            <tr>
              <td id="visite">ğŸ•‰ï¸ Hindu temples and spirals of incense</td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
	  <section class="access-content" aria-labelledby="subtitles_bali">
		  <h3 id="subtitles_bali">ğŸ§ Subtitles & Transcription â€“ Room 2: Bali</h3>
		  <ul>
			<li>[Gentle rustling of rice stalks â€” harmony with nature]</li>
			<li>[Soft chanting of prayers â€” spiritual essence]</li>
			<li>[Spirals of incense smoke â€” fragrant devotion]</li>
		  </ul>
		  <p class="transcription">
			The rice fields stretch endlessly, their terraces a testament to harmony with nature.  
			Offerings of flowers and incense bring color and fragrance to the scene.  
			Temples stand as guardians of tradition, their presence a reminder of Bali's spiritual essence.
		  </p>
		   <div class="retour-navigation">
		    <a href="#quick-navigation" class="nav-btn retour" title="Return to subtitle index">ğŸ” Back to Quick Navigation</a>
		  </div>
	 </section>
    </section>

    <!-- ğŸŒ¾ Room 3 â€” Flores Island -->
    <section id="flores" role="region" aria-labelledby="salle_flores">
      <h2 id="salle_flores">ğŸŒ¾ Room 3 â€” Flores Island</h2>
      <div class="table-image-container">
        <img src="Komodo.jpg" id="terasse_flores" alt="Komodo dragon near pink beach and coral reef on Flores Island" />
        <table>
          <thead>
            <tr>
              <th id="element3">Element</th>
              <th id="lien3">Link</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td id="komodo">ğŸŒº Komodo dragons and pink beaches</td>
              <td></td>
            </tr>
            <tr>
              <td id="coral">ğŸŒŠ Coral reefs and underwater wonders</td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
	  <section class="access-content" aria-labelledby="subtitles_flores">
		  <h3 id="subtitles_flores">ğŸ§ Subtitles & Transcription â€“ Room 3: Flores</h3>
		  <ul>
			<li>[Gentle lapping of waves â€” soothing rhythm]</li>
			<li>[Rustle of leaves â€” vibrant foliage]</li>
			<li>[Distant calls of exotic birds â€” untamed spirit]</li>
		  </ul>
		  <p class="transcription">
			Flores Island is a haven of natural wonders.  
			Komodo dragons embody the island's untamed spirit, while pink beaches and coral reefs showcase its vibrant beauty.  
			The sounds of nature envelop you, painting a picture of serenity and adventure.
		  </p>
		   <div class="retour-navigation">
		    <a href="#quick-navigation" class="nav-btn retour" title="Return to subtitle index">ğŸ” Back to Quick Navigation</a>
		  </div>
	  </section>
    </section>

     <!-- ğŸ”ï¸ Room 4 â€” Peruâ€™s Sacred Valley -->
    <section id="perou" role="region" aria-labelledby="salle_perou">
      <h2 id="salle_perou">ğŸ”ï¸ Room 4 â€” Peruâ€™s Sacred Valley</h2>
      <div class="table-image-container">
        <img src="Macchu Pichu.jpg" id="saline_perou" alt="Fractal view of Machu Picchu surrounded by golden cathedral-like circles" />
        <table>
          <thead>
            <tr>
              <th id="element4">Element</th>
              <th id="lien4">Link</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td id="chant">ğŸ”ï¸ Majestic Andes and ancient terraces</td>
              <td></td>
            </tr>
            <tr>
              <td id="foret">ğŸŒ„ Machu Picchu and Inca heritage</td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
	<section class="access-content" aria-labelledby="subtitles_peru">
	  <h3 id="subtitles_peru">ğŸ§ Subtitles & Transcription â€“ Room 4: Peru</h3>
	  <ul>
		<li>[Whisper of the wind through the mountains â€” timeless serenity]</li>
		<li>[Distant sound of flowing rivers â€” life's pulse]</li>
		<li>[Echoes of history â€” profound legacy]</li>
	  </ul>
	  <p class="transcription">
		The Sacred Valley is a place of awe and wonder.  
		The Andes dominate the horizon, while Machu Picchu invites you to explore its mysteries.  
		Encircling this iconic site are concentric golden patterns reminiscent of cathedral adornments, adding a divine aura to the scene.  
		The sounds of nature and history intertwine, offering a glimpse into the soul of Peru.
	  </p>
	   <div class="retour-navigation">
		    <a href="#quick-navigation" class="nav-btn retour" title="Return to subtitle index">ğŸ” Back to Quick Navigation</a>
		  </div>
	</section>
  </main>

  <!-- ğŸŒŒ Footer -->
  <footer role="contentinfo">
    <section id="cloture" class="cloture" aria-labelledby="cloture_visite">
      <div class="titre-cloture">
        <h2 id="cloture_visite">ğŸ–¼ï¸ Contemplative Epilogue â€“ Closing of the Visit</h2>
        <button id="btn_exit" class="close-poetique" title="End the journey">ğŸŒŒ Exit</button>
      </div>
      <div id="epilogue" class="citation-stylisee">
        And when the lights go out, the fractals keep dancing in the dark.  
        They whisper ancient stories, forgotten secrets, and dreams yet to come.  
        Every reflection is a promise, every spiral an endless journey.
      </div>
    </section>
  </footer>

<script>

  // ğŸ”§ Fonctions utilitaires
  const openedLinks = new Set();
  let windowCounter = 0;

  // Console	
  function logMessage(msg) {
    const logDiv = document.getElementById("console-log");
    if (logDiv) logDiv.innerHTML += msg + "<br>";
  }

  function updateWindowCounter() {
    const counterDiv = document.getElementById("window-counter");
    if (counterDiv) counterDiv.textContent = `ğŸªŸ FenÃªtres ouvertes : ${windowCounter}`;
  }

  function resetOpenedLinks() {
    openedLinks.clear();
    windowCounter = 0;
    updateWindowCounter();
    logMessage("ğŸ”„ Liste des onglets rÃ©initialisÃ©e");
  }

  // ğŸ–±ï¸ Position souris
  document.addEventListener("mousemove", event => {
    const x = event.clientX;
    const y = event.clientY;
    const coordDiv = document.getElementById("coordinates");
    if (coordDiv) coordDiv.textContent = `Position de la souris : X = ${x}, Y = ${y}`;
  });

  // ğŸŒ Liens externes
  document.querySelectorAll('a[target="_blank"]').forEach(link => {
    link.addEventListener("click", e => {
      const url = link.href;
      if (!openedLinks.has(url)) {
        openedLinks.add(url);
        windowCounter++;
        updateWindowCounter();
        logMessage(`ğŸªŸ Onglet ouvert : ${url}`);
      } else {
        e.preventDefault();
        logMessage(`ğŸ” Onglet dÃ©jÃ  ouvert : ${url}`);
      }
    });
  });
</script>

<script>
	
	// Navigation et carte interactive
	const handleNavigation = (sourceElement, type) => {
	  const classList = Array.from(sourceElement.classList);
	  const salleName = classList.find(cls =>
		["hampi", "bali", "flores", "perou"].includes(cls)
	  );

	  if (!salleName) return;

	  const langSuffix = classList.includes("carte-point-en") || classList.includes("debug-zone-en") ? "en" : "fr";
	  const targetType = type === "debug-zone" ? "carte-point" : "debug-zone";
	  // logMessage(`ğŸ¯ Type source : ${type}, cible : ${targetType}`);

	  const highlightTarget = Array.from(document.querySelectorAll(`.${targetType}-${langSuffix}`))
		.find(el => el.classList.contains(salleName));

	  if (highlightTarget) {
		// logMessage(`âœ… Surbrillance : ${targetType}-${langSuffix} â†’ ${highlightTarget.className}`);
		highlightTarget.classList.add("highlight");
		setTimeout(() => highlightTarget.classList.remove("highlight"), 1000);
	  } else {
		logMessage(`âŒ Aucun Ã©lÃ©ment trouvÃ© pour salle : ${salleName}`);
	  }

	  const scrollTarget = document.querySelector(`#${salleName}`);
	  if (scrollTarget) {
		setTimeout(() => scrollTarget.scrollIntoView({ behavior: "smooth" }), 1000);
	  }
	};

	  // ğŸ–±ï¸ Ã‰couteurs sur les zones interactives
	  document.querySelectorAll(".debug-zone-fr, .debug-zone-en").forEach(zone =>
	  zone.addEventListener("click", e => {
		e.preventDefault();
		// logMessage("ğŸ–±ï¸ Zone cliquÃ©e : " + zone.className);
		handleNavigation(zone, "debug-zone"); // â† bon type
	  })
	);

	document.querySelectorAll(".carte-point-fr, .carte-point-en").forEach(point =>
	  point.addEventListener("click", e => {
		e.preventDefault();
		// logMessage("ğŸ“ Point cliquÃ© : " + point.className);
		handleNavigation(point, "carte-point"); // â† bon type
	  })
	);

	document.addEventListener("DOMContentLoaded", () => {
	  // ğŸ” DÃ©tection de la langue active
	  //const navLang = navigator.language.startsWith("fr") ? "fr" : "en";
	  //const langSuffix = navlang;

	  // Tu peux continuer ici avec ton code...
	  // logMessage("Langue dÃ©tectÃ©e : " + langSuffix);
	});
</script>

<script>

    // lecture de langues.txt
	const navLang = navigator.language.startsWith("fr") ? "fr" : "en";
	langueActuelle = navLang;

	async function chargerLangues(url) {
	  const re = /^\[([^\]]+)\]\s*["']([^"']+)["']/;
	  const dictionnaire = {};
	  const response = await fetch(url);
	  const texte = await response.text();
	  texte.split('\n').forEach(ligne => {
		const match = ligne.match(re);
		if (match) {
		  dictionnaire[match[1]] = match[2];
		}
	  });

	  return dictionnaire;
	}

	function appliquerTextes(labels, langue) {
	  for (const cle in labels) {
		const baseId = cle.endsWith(`_${langue}`) 
	  ? cle.slice(0, -(`_${langue}`.length)) 
	  : cle;
		const element = document.getElementById(baseId);
		if (element) {
		  element.textContent = labels[cle];
		}
	  }
	}

    // Met Ã  jour les titres   
	function modifierTitres(langue) {
     
		const boutonEnter = document.getElementById("btn_enter");
		modifierTitresLien(boutonEnter, langue);

		const boutonExit = document.getElementById("btn_exit");
		modifierTitresLien(boutonExit, langue);
		
		const boutonMap0 = document.getElementById("btn_map_0");
		modifierTitresLien(boutonMap0, langue);
		
		const boutonMap1 = document.getElementById("btn_map_1");
		modifierTitresLien(boutonMap1, langue);
		
		const boutonSummary0 = document.getElementById("btn_summary_0");
		modifierTitresLien(boutonSummary0, langue);
		
		const boutonEpilogue = document.getElementById("btn_epilogue");
		modifierTitresLien(boutonEpilogue, langue);
		
		const imageHampi = document.getElementById("char_hampi")
		modifierTitresLien(imageHampi, langue);
		
		const imageBali = document.getElementById("paysage_bali")
		modifierTitresLien(imageBali, langue);
		
		const imageFlores = document.getElementById("terasse_flores")
		modifierTitresLien(imageFlores, langue);
		
		const imagePerou = document.getElementById("saline_perou")
		modifierTitresLien(imagePerou, langue);
    }	

    // modif propriÃ©tÃ© title des boutons
    function modifierTitresLien(objet, langue) {
	  if (!objet) return;
	  let nouveauTitre = "";
	  switch (objet.id) {
		case "btn_enter":
		  switch (langue) {
			case "fr":
			  nouveauTitre = "Commencer le voyage poÃ©tique";
			  break;
			case "en":
			  nouveauTitre = "Begin the poetic journey";
			  break;
			default:
			  nouveauTitre = "Commencer le voyage poÃ©tique";
		  }
		  break;
		case "btn_exit":
		  switch (langue) {
			case "fr":
			  nouveauTitre = "Quitter lâ€™exposition";
			  break;
			case "en":
			  nouveauTitre = "Exit the exhibition";
			  break;
			default:
			  nouveauTitre = "Quitter lâ€™exposition";
		  }
		  break;
		  case "btn_map_0":
			switch (langue) {
			case "fr":
			  nouveauTitre = "AccÃ©der Ã  la carte interactive";
			  break;
			case "en":
			  nouveauTitre = "Access the Interactive Map";
			  break;
			default:
			  nouveauTitre = "AccÃ©der Ã  la carte interactive";
		  }
		  break;	
		  case "btn_map_1":
			switch (langue) {
			case "fr":
			  nouveauTitre = "AccÃ©der Ã  la carte interactive";
			  break;
			case "en":
			  nouveauTitre = "Access the Interactive Map";
			  break;
			default:
			  nouveauTitre = "AccÃ©der Ã  la carte interactive";
		  }
		  break;	
		  case "btn_summary_0":
			switch (langue) {
			case "fr":
			  nouveauTitre = "AccÃ©der au sommaire de l'exposition";
			  break;
			case "en":
			  nouveauTitre = "Access the Exhibition Summary";
			  break;
			default:
			  nouveauTitre = "AccÃ©der au sommaire de l'exposition";
		  }
		  break;	
		  case "btn_epilogue":
			switch (langue) {
			case "fr":
			  nouveauTitre = "Lire lâ€™Ã©pilogue poÃ©tique";
			  break;
			case "en":
			  nouveauTitre = "Read the poetic epilogue";
			  break;
			default:
			  nouveauTitre = "Lire lâ€™Ã©pilogue poÃ©tique";
		  }
		  break;
		  case "char_hampi":
		  switch (langue) {
		  case "fr":
			  nouveauTitre = "Char mystique de Hampi";
			  break;
			case "en":
			  nouveauTitre = "Mystical chariot of Hampi";
			  break;
			default:
			  nouveauTitre = "Char mystique de Hampi";
		  }
		  break;
		   case "paysage_bali":
		  switch (langue) {
		  case "fr":
			  nouveauTitre = "Paysage spirituel balinais : riziÃ¨res et mandalas";
			  break;
			case "en":
			  nouveauTitre = "Balinese spiritual landscape: rice fields and mandalas";
			  break;
			default:
			  nouveauTitre = "Paysage spirituel balinais : riziÃ¨res et mandalas";
		  }
		  break;
		  case "terasse_flores":
		  switch (langue) {
		  case "fr":
			  nouveauTitre = "Terrasses de riz en fleurs Ã  FlorÃ¨s";
			  break;
			case "en":
			  nouveauTitre = "Flowering rice terraces in Flores";
			  break;
			default:
			  nouveauTitre = "Terrasses de riz en fleurs Ã  FlorÃ¨s";
		  }
		  break;
		  case "saline_perou":
		  switch (langue) {
		  case "fr":
			  nouveauTitre = "Salines fractales pÃ©ruviennes";
			  break;
			case "en":
			  nouveauTitre = "Peruvian Fractal Salt Flats";
			  break;
			default:
			  nouveauTitre = "Salines fractales pÃ©ruviennes";
		  }
		  break;
		  
		// Ajoute d'autres cas ici si tu as plus de boutons
		default:
			nouveauTitre = "Lien de navigation";
		 }
		 objet.setAttribute("title", nouveauTitre);
		}

	// langues fr ou en, div id="lang-switch"
	function switchLangue() {
	  langueActuelle = (langueActuelle === 'fr') ? 'en' : 'fr';

	  chargerLangues('https://ovalentini.github.io/Fractales/langues.txt').then(labels => {
		appliquerTextes(labels, langueActuelle);

		// âœ… Afficher les bons Ã©lÃ©ments une fois les textes appliquÃ©s
		setTimeout(() => {
		afficherElementsLangue(langueActuelle);
		modifierTitres(langueActuelle);
		inspecterZonesOpposÃ©es(langueActuelle);
	  }, 100); // ou plus si nÃ©cessaire
	});
		nettoyerSallesDynamiques();
		dispatchSalle(langueActuelle, 1); // insÃ¨re la salle 1 en langueActuelle
		dispatchSalle(langueActuelle, 2); // insÃ¨re la salle 2 en langueActuelle
		dispatchSalle(langueActuelle, 3); // insÃ¨re la salle 3 en langueActuelle
		dispatchSalle(langueActuelle, 4); // insÃ¨re la salle 4 en langueActuelle
	}

	function inspecterZonesOpposÃ©es(langue) {
	  const langueOpposÃ©e = langueActuelle === 'fr' ? 'en' : 'fr';
	  const zonesOpposÃ©es = document.querySelectorAll(`.debug-zone-${langueOpposÃ©e}`);
	  if (zonesOpposÃ©es.length === 0) {
		logMessage(`â„¹ï¸ Aucun Ã©lÃ©ment trouvÃ© pour la langue opposÃ©e : ${langueOpposÃ©e}`);
		return;
	  }
	  zonesOpposÃ©es.forEach(el => {
		// logMessage(`ğŸ” Zone opposÃ©e : ${el.className}, visible: ${el.classList.contains('visible')}`);
		// Tu peux aussi manipuler ici, par exemple :
		// el.classList.add('masquÃ©');
	  });
	}

	function afficherElementsLangue(langue) {
	  const zones = document.querySelectorAll(`.debug-zone-${langue}`);
	  const points = document.querySelectorAll(`.carte-point-${langue}`);
	  if (zones.length === 0 && points.length === 0) {
		logMessage(`âš ï¸ Aucun Ã©lÃ©ment trouvÃ© pour la langue : ${langue}`);
		return;
	  }
	  document.querySelectorAll('.debug-zone-fr, .carte-point-fr, .debug-zone-en, .carte-point-en').forEach(el => {
		el.classList.remove('visible');
	  });
	  zones.forEach(el => el.classList.add('visible'));
	  points.forEach(el => el.classList.add('visible'));
	  
	  document.body.className = `lang-${langueActuelle}`;

	  // ğŸ³ï¸ Met Ã  jour le drapeau et le texte du bouton
	  const flagImg = document.querySelector('.inline-flag');
	  const flagBtn = document.getElementById('btn_flag');

	  if (langueActuelle === 'fr') {
		flagImg.src = 'drapeaux/fr.png';
		flagImg.alt = 'Drapeau France';
		flagBtn.textContent = 'FranÃ§ais';
		flagBtn.title = 'Click to switch to English'; 
	  } else {
		flagImg.src = 'drapeaux/en.png';
		flagImg.alt = 'Flag UK';
		flagBtn.textContent = 'English';
		flagBtn.title = 'Cliquer pour passer en FranÃ§ais'; 
	  }

	  // ğŸ–¼ï¸ Met Ã  jour de lâ€™image et de la lÃ©gende
	  const img = document.getElementById("fractals-img");
	  const caption = document.getElementById("image-caption");

	  if (langueActuelle === 'fr') {
		img.src = "carte-interactive-fr.jpg";
		img.alt = "Fractales du Monde";
		img.title = "Cliquer sur une zone ou un point pour aller Ã  la salle correspondante";
		caption.textContent = "Chaque spirale raconte une histoire. Laissez les motifs guider votre Ã¢me.";
	  } else {
		img.src = "carte-interactive-en.jpg";
		img.alt = "Fractals of the World";
		img.title = "Click on an area or point to go to the corresponding room"
		caption.textContent = "Each spiral tells a story. Let the patterns guide your soul.";
	}
	  
	}

    // Construction des salles, div id="salles-dynamiques"  
	function dispatchSalle(language, salleNumber) {
	  const salles = {
	  salle1: {
		en: {
		  id: "salle1_en",
		  title: "ğŸ•‰ï¸ Room 1 â€” Hampi Market",
		  elements: [
		  { text:  "âœ¨ Mystical chariot of Hampi" },
		  { text: "ğŸŒˆ Mandalas and flowing fabrics" },
		  {  
		   text:"ğŸµ Soundscape: Musical pillars of the Vithala temple  â€” ",
		   link: {
			href: "https://www.youtube.com/watch?v=UOFoQ70m6Z8",
			label: "Listen"
			}
		  }
		  ]
		},
		fr: {
		  id: "salle1_fr",
		  title: "ğŸ•‰ï¸ Salle 1 â€” MarchÃ© de Hampi",
		  elements: [
		  { text: "âœ¨ Char mystique de Hampi" },
		  { text: "ğŸŒˆ  Mandalas et Ã©toffes ondulantes" },
		  {
			text: "ğŸµ  Paysage sonore : Piliers musicaux du temple Vithala â€” ",
			link: {
			  href: "https://www.youtube.com/watch?v=UOFoQ70m6Z8",
			  label: "Ã‰couter"
			}
		  }
		]
	   }
	  },
	  salle2: {
		en: {
		  id: "salle2_en",
		  title: "ğŸŒº Room 2 â€” Bali the beautiful island",
		  elements: [
		  { text: "ğŸŒ¾ Sacred rice fields and offerings"},
		  { text: "ğŸ•‰ Hindu temples and spirals of incense"},
		  {
			text: "ğŸ¶ Soundscape: Balinese gamelan â€” ",
			link: {
				   href: "https://www.routard.com/fr/photo/p/345-bali",
				   label: "Listen"
				   }
		  }
		  ]
		},
		fr: {
		  id: "salle2_fr",
		  title: "ğŸŒº Salle 2 â€” Bali, lâ€™Ã®le magnifique",
		  elements: [
		  { text: "ğŸŒ¾ RiziÃ¨res sacrÃ©es et offrandes"},
		  { text: "ğŸ•‰ Temples hindous et spirales dâ€™encens"},
		  { 
		  text: "ğŸ¶ Ambiance sonore : Gamelan balinais â€” ",
		  link: {
				 href: "https://www.routard.com/fr/photo/p/345-bali",
				 label: "Ã‰couter"
				 }
		  }
		  ]
		}
	  },
	  salle3: {
		en: {
		  id: "salle3_en",
		  title: "ğŸŒ¾ Room 3 - Rice field flowers (Flores)",
		  elements: [
		  { text: "ğŸŒ¸ Rice terraces in petals"},
		  { text: "ğŸ’§ Plant spirals and aquatic light"},
		  {
		   text: "ğŸµ Soundscape: Rice field lullabies â€” ",
		   link: {
				  href: "https://munki.audio/catalogue/albums/410/artistes-divers--comptines-et-berceuses-des-rizieres",
				  label: "Listen"
				   }
		  }
		  ]
		},
		fr: {
		  id: "salle3_fr",
		  title: "ğŸŒ¾ Salle 3 - Fleurs de riziÃ¨res (FlorÃ¨s)",
		  elements: [
		  { text: "ğŸŒ¸ Terrasses de riz en pÃ©tales$"},
		  { text: "ğŸ’§ Spirales vÃ©gÃ©tales et lumiÃ¨re aquatique"},
		  {
		   text: "ğŸµ Ambiance sonore : Berceuses des riziÃ¨res â€” ",
		   link: {
				  href: "https://munki.audio/catalogue/albums/410/artistes-divers--comptines-et-berceuses-des-rizieres",
				  label: "Ecouter"
				  }
		  }
		  ]
		}
	  },
	  salle4: {
		en: {
		  id: "salle4_en",
		  title: "ğŸ”ï¸ Room 4 - Amazonian Salt Flats",
		  elements: [
			{ text: "âœ¨ Salt terraces and fractal reflections"},
			{ text: "ğŸŒŠ Aquatic geometry and mineral memory"},
			{
			 text: "ğŸ¶ Soundscape: Traditional Amazonian chants â€” ",
			 link: {
					href: "https://www.youtube.com/watch?v=jm4lKVxihI4",
					label: "Listen"
					}
			}
		  ]
		},
		fr: {
		  id: "salle4_fr",
		  title: "ğŸ”ï¸ Salle 4 - Salines Amazoniennes",   
		  elements: [
			{ text: "âœ¨ Terrasses de sel et reflets fractals"},
			{ text: "ğŸŒŠ GÃ©omÃ©trie aquatique et mÃ©moire minÃ©rale"},
			{
			 text: "ğŸ¶ Ambiance sonore : Chants traditionnels amazoniens â€” ",
			 link: {
					href: "https://www.youtube.com/watch?v=jm4lKVxihI4",
					label: "Ecouter"
					}
			}
		  ]
		}
	  }
	};

      // toujours la fonction dispatchSalle
	  const selectedSalle = salles[`salle${salleNumber}`];
	  if (!selectedSalle) return;

	  const selectedLanguage = selectedSalle[language];
	  if (!selectedLanguage) return;

	  const container = document.getElementById("salles-dynamiques");
	  if (!container) return;

	  // Supprime lâ€™ancienne version si elle existe
	  const existing = document.getElementById(selectedLanguage.id);
	  if (existing) existing.parentNode.remove();

	  const newDiv = document.createElement("div");
	  newDiv.className = `salle-${salleNumber}`;

	  const title = document.createElement("h3");
	  title.id = selectedLanguage.id;
	  title.innerHTML = `<strong>${selectedLanguage.title}</strong>`;
	  newDiv.appendChild(title);

	  const ul = document.createElement("ul");
	  ul.className = "liste-Ã©lÃ©ments";
	  selectedLanguage.elements.forEach(element => {
	  const li = document.createElement("li");
	  if (typeof element === "string") {
		li.textContent = element;
	  } else {
		li.textContent = element.text;
		if (element.link) {
		  const a = document.createElement("a");
		  a.href = element.link.href;
		  a.target = "_blank";
		  a.textContent = element.link.label;
		  li.appendChild(a);
		}
	  }
	  ul.appendChild(li);
	});
	  newDiv.appendChild(ul);

	  container.appendChild(newDiv);
	}

	function nettoyerSallesDynamiques() {
	  const container = document.getElementById("salles-dynamiques");
	  if (container) container.innerHTML = "";
	}

    // bouton quitter
	document.querySelector(".close-poetique").addEventListener("click", function () {
		document.body.classList.add("fusion-galactique");
		setTimeout(() => {
		  window.location.href = "https://ovalentini.github.io/Fractales/carte.html?lang=" + langueActuelle; // Ou la page finale de ton choix
		}, 2000); // Laisse le temps Ã  lâ€™animation de s'Ã©panouir
	});

	// Au chargement, appliquer la langue prÃ©fÃ©rÃ©e ou par dÃ©faut
	  function initialiserLangue() {
	  const navLang = navigator.language.startsWith("fr") ? "fr" : "en";
	  langueActuelle = navLang;
	  chargerLangues('https://ovalentini.github.io/Fractales/langues.txt').then(labels => {
		appliquerTextes(labels, langueActuelle);
		afficherElementsLangue(langueActuelle);
		modifierTitres(langueActuelle);
		inspecterZonesOpposÃ©es(langueActuelle);
		nettoyerSallesDynamiques();
		dispatchSalle(langueActuelle, 1); // insÃ¨re la salle 1 en langueActuelle
		dispatchSalle(langueActuelle, 2); // insÃ¨re la salle 2 en langueActuelle
		dispatchSalle(langueActuelle, 3); // insÃ¨re la salle 3 en langueActuelle
		dispatchSalle(langueActuelle, 4); // insÃ¨re la salle 4 en langueActuelle
	});
	}

	/*window.addEventListener('DOMContentLoaded', initialiserLangue);*/
</script>
</body>
</html>
